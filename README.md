# Лукойл Дисконт

## Обзор
Проект Лукойл Дисконт представляет собой комплексную платформу для управления торговлей остатков топлива. Он состоит из нескольких взаимосвязанных сервисов:

1. **Бэкенд-сервис (besth_back)**: REST API на основе Django REST Framework, обрабатывающий основную бизнес-логику
2. **FTP-сервис**: Настраиваемый FTP-сервер, принимающий загрузки CSV-файлов для пакетной обработки партий топлива
3. **База данных PostgreSQL**: Для хранения данных

## Бэкенд-сервис (besth_back)

Приложение Django REST framework, предоставляющее API-эндпоинты для управления торговлей топливом.

### Ключевые функции

- Аутентификация и авторизация пользователей с помощью JWT
- Управление партиями топлива
- Обработка заказов
- Импорт CSV для пакетных операций
- Автоматизированные задачи с использованием Celery для очистки просроченных партий

### Основные модели

- **OilBase**: Представляет нефтебазу (склад топлива)
- **FuelType**: Различные типы доступного топлива
- **Lot**: Доступные для покупки партии топлива
- **Order**: Завершенные покупки пользователей

### API-эндпоинты

- `/users/token/`: JWT-аутентификация
- `/trade/lots/`: Управление партиями топлива
- `/trade/orders/`: Обработка заказов
- `/trade/upload-csv/`: Загрузка данных CSV
- `/trade/fuel-types/`: Управление типами топлива
- `/trade/oil-bases/`: Управление нефтебазами

### Технологический стек

- Django
- Django REST Framework
- PostgreSQL
- Redis
- Celery
- Docker

## FTP-сервис

Отдельный FTP-сервер, построенный с использованием pyftpdlib, который позволяет аутентифицированным пользователям загружать CSV-файлы, содержащие данные о партиях топлива.

### Ключевые функции

- Аутентификация через бэкенд Django
- Валидация CSV-файлов
- Автоматическая обработка и импорт в бэкенд

### Технологический стек

- Python
- pyftpdlib
- pandas
- Docker

## База данных

PostgreSQL используется в качестве основной базы данных для хранения всех постоянных данных.

## Формат импорта CSV

Система принимает CSV-файлы со следующими столбцами:
- `lot_date`: Дата партии
- `ksss_nb_code`: Код КССС нефтебазы
- `ksss_fuel_code`: Код КССС типа топлива
- `initial_volume`: Начальный объем в тоннах
- `available_volume`: Доступный объем в тоннах
- `status`: Статус партии (Подтвержден, Продан, Неактивен)
- `price_per_ton`: Цена за тонну в рублях

## Запланированные задачи

Система использует Celery для выполнения запланированных задач:
- `lot_cleaning`: Выполняется каждые 12 часов для маркировки просроченных партий как неактивных

## Безопасность

- Аутентификация на основе JWT
- Доступ к FTP-службе загрузки только для персонала
- Конфигурация на основе переменных окружения

## Развертывание

Все сервисы контейнеризированы с использованием Docker и могут быть развернуты с помощью Docker Compose или любой системы оркестрации контейнеров.
